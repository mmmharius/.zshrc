export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME=""
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)

source $ZSH/oh-my-zsh.sh

[[ -f $ZSH/custom/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh ]] && source $ZSH/custom/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
[[ -f $ZSH/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]] && source $ZSH/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

export LS_COLORS="di=0:ln=0:so=0:pi=0:ex=0:bd=0:cd=0:su=0:sg=0:tw=0:ow=0"

export LANG=fr_FR.UTF-8
export LC_ALL=fr_FR.UTF-8
export LC_TIME=fr_FR.UTF-8
export LC_NUMERIC=fr_FR.UTF-8
export LC_MONETARY=fr_FR.UTF-8

function afficher_heure_droite() {
    local heure_fr=$(date '+%H:%M:%S')
    local date_courte=$(date '+%d/%m')
    local affichage="$date_courte $heure_fr"
    local largeur_terminal=$(tput cols)
    local longueur_affichage=${#affichage}
    local position=$((largeur_terminal - longueur_affichage))
    printf "\033[s\033[1;${position}H\033[1;36m%s\033[0m\033[u" "$affichage"
}

typeset -g last_exit_code=0

function git_branch_prompt() {
    local branch=$(git symbolic-ref --short HEAD 2>/dev/null)
    [[ -n "$branch" ]] && echo " %F{red}(${branch})%f"
}

function venv_prompt() {
    if [[ -n "$VIRTUAL_ENV" ]]; then
        local venv_name=$(basename "$VIRTUAL_ENV")
        echo " %F{red}(${venv_name})%f"
    fi
}

function precmd() {
    last_exit_code=$?
    afficher_heure_droite
    local dossier="${PWD##*/}"
    local branch=$(git_branch_prompt)
    local venv=$(venv_prompt)
    local fleche_couleur=$([[ $last_exit_code -eq 0 ]] && echo "%F{blue}" || echo "%F{red}")
    PROMPT="${fleche_couleur}➜ %f%F{cyan}${dossier}%f${branch}${venv} "
}

function preexec() {
    afficher_heure_droite
}

function clear_avec_heure() {
    command clear
    afficher_heure_droite
    echo
}

function whoami() {
    cat << "EOF"
╔═══════════════════════════════════════════════════════════════╗
║  ██╗   ██╗███████╗███████╗██████╗  ██████╗ ███╗   ██╗███████╗ ║
║  ██║   ██║██╔════╝██╔════╝██╔══██╗██╔═══██╗████╗  ██║██╔════╝ ║
║  ██║   ██║███████╗█████╗  ██████╔╝██║   ██║██╔██╗ ██║█████╗   ║
║  ██║   ██║╚════██║██╔══╝  ██╔══██╗██║   ██║██║╚██╗██║██╔══╝   ║
║  ╚██████╔╝███████║███████╗██║  ██║╚██████╔╝██║ ╚████║███████╗ ║
║   ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝ ║
╚═══════════════════════════════════════════════════════════════╝
EOF
}

ZSH_HIGHLIGHT_STYLES[command]='fg=078'
ZSH_HIGHLIGHT_STYLES[unknown-token]='fg=197'
ZSH_HIGHLIGHT_STYLES[comment]='fg=240'
ZSH_HIGHLIGHT_STYLES[alias]='fg=078'
ZSH_HIGHLIGHT_STYLES[builtin]='fg=078'
ZSH_HIGHLIGHT_STYLES[function]='fg=078'

[[ -f ~/.ssh/id_rsa ]] && ssh-add ~/.ssh/id_rsa 2>/dev/null

autoload -U colors && colors
autoload -U compinit && compinit
zstyle ':completion:*' list-colors "${LS_COLORS}"
zstyle ':completion:*' menu select
zstyle ':completion:*' select-prompt ''

alias clear='clear_avec_heure'
alias clr='clear_avec_heure'
alias gs="git status"
alias gl="git log --oneline --graph --decorate"
alias gb="git branch"
alias ga="git add ."
alias gc="git commit -m"
alias gp="git push"
alias gpm="git push origin HEAD:main"
alias gpl="git pull"
alias glog="git log --oneline --graph --decorate"
alias whoami="whoami"

[[ -d /media/user/8622226222225807/sys42 ]] && cd /media/user/8622226222225807/sys42
afficher_heure_droite
